<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Card</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
  <script defer src="/js/productCard.js"></script>
</head>
<body>
  <%- include('partials/deleteDialog') %>
  
  <%- include('partials/header')%>

  <main class="product-card__container">
    <div class="product-card__header">
      <h1><%= product.name %></h1>

      <div class="product-card__buttons">
        <button>
          <a href="/products">Go Back</a>
        </button>
  
        <button>
          <a href="/forms/<%= product.id %>">Update</a>
        </button>
  
        <button class="button--delete" onclick="confirmDelete()">
          Delete
        </button>
      </div>
    </div>

    <div class="product-card__main">
      <div class="product-card__image-container">
        <img src="<%= product.photo_url %>" alt="<%= product.name %>" />  
      </div>
      <div class="product-card__info">
        <p><b>Brand:</b> <%= product.brand_name %></p>
        <p><b>Description:</b> <%= product.description %></p>
        <p><b>Category:</b> <%= product.category_name %></p>
        <p><b>Skin Type:</b> <%= product.skintype_name %></p>
      </div>
    </div>

    <% if (errors) { %>
      <% errors.forEach(error => { %>
        <div><%= error.msg %></div>
      <% })%>
    <% } %>

    <% if (user) { %>
      <form action="/products/<%= product.id %>/review" method="POST">
        <label for="product-card__textarea">Leave a Review</label>
        <textarea name="review" id="product-card__textarea" rows="5" maxlength="1000"></textarea>
        <button type="submit">Comment</button>
      </form>
    <% } %>

    <% if (reviews && reviews.length > 0) { %>
      <% reviews.forEach(review => { %>
        <div class="product-card__review-item">
          <div class="product-card__review-message"><%= review.message %></div>
          <div class="product-card__review-user">
            <% if (user) { %>
              <%= review.username || "Deleted User" %>
            <% } %>
          </div>
          <div class="product-card__review-time"><%= review.time %></div>
        </div>
      <% }) %>
    <% } else { %>
      <p>No reviews yet. Be the first to leave one!</p>
    <% } %>

  </main>
</body>
</html>